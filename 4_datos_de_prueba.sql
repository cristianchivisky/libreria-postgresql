--Revisar que sean coherentes las fechas de las promociones. 
BEGIN;
---Este trigger, calcula el total de un pedido, según los libros de las líneas de carrito y la cantidad,
---además le aplica los descuentos correspondientes a promoción y también suma el costo de envío, 
---cuando se inserta un pedido no es necesario pasarle el total.

CREATE OR REPLACE FUNCTION calcular_total_pedido()
RETURNS TRIGGER AS $$
DECLARE
    total_pedido NUMERIC(10,2);
    descuento_promocion NUMERIC(10,2);
BEGIN
    -- Calcula el total sin descuento
    SELECT SUM(ejemplar.precio * linea_carrito.cantidad)
    INTO total_pedido
    FROM linea_carrito
    JOIN ejemplar ON linea_carrito.id_ejemplar = ejemplar.isbn
    WHERE linea_carrito.id_carrito = (SELECT id_carrito FROM usuario WHERE usuario.id_usuario = NEW.id_usuario);
 
    -- Verificar si hay descuentos de promociOn
    SELECT COALESCE(SUM(promocion_descuento.porcentaje * ejemplar.precio * linea_carrito.cantidad / 100), 0)
    INTO descuento_promocion
    FROM linea_carrito
    JOIN ejemplar ON linea_carrito.id_ejemplar = ejemplar.isbn
    LEFT JOIN ejemplar_promocion ON ejemplar.isbn = ejemplar_promocion.id_ejemplar
    LEFT JOIN promocion_descuento ON ejemplar_promocion.id_promocion_descuento = promocion_descuento.id_promocion_descuento
    WHERE linea_carrito.id_carrito = (SELECT id_carrito FROM usuario WHERE usuario.id_usuario = NEW.id_usuario)
      AND promocion_descuento.fecha_inicio <= CURRENT_TIMESTAMP
      AND promocion_descuento.fecha_fin >= CURRENT_TIMESTAMP;

    total_pedido := total_pedido - descuento_promocion;

    -- Agrega el costo de envío al total calculado
    total_pedido := total_pedido + NEW.costo_envio;

    -- Asigna el total calculado a las columnas 'total_con_descuento' y 'total' del nuevo pedido
     NEW.total_con_descuento := total_pedido;
    NEW.total := total_pedido + descuento_promocion;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER calcular_total_trigger
BEFORE INSERT ON pedido
FOR EACH ROW
EXECUTE FUNCTION calcular_total_pedido();



-- Carga de datos ficticios para pruebas.

SELECT  SETVAL(c.oid, 1, false)
from pg_class c JOIN pg_namespace n 
on n.oid = c.relnamespace 
where c.relkind = 'S' and n.nspname = 'public';

INSERT INTO usuario (id_usuario, nombre, apellido, email, imagen)
VALUES
  ('1', 'Juan', 'Pérez', 'juan.perez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('2', 'María', 'Gómez', 'maria.gomez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('3', 'Luis', 'Martínez', 'luis.martinez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('4', 'Ana', 'Rodríguez', 'ana.rodriguez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('5', 'Carlos', 'Sánchez', 'carlos.sanchez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('6', 'Laura', 'Hernández', 'laura.hernandez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('7', 'Pedro', 'García', 'pedro.garcia@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('8', 'Isabel', 'Díaz', 'isabel.diaz@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('9', 'Miguel', 'López', 'miguel.lopez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('10', 'Sofía', 'Fernández', 'sofia.fernandez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('11', 'Javier', 'Torres', 'javier.torres@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('12', 'Elena', 'Ruiz', 'elena.ruiz@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('13', 'Francisco', 'Vargas', 'francisco.vargas@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('14', 'Carmen', 'Moreno', 'carmen.moreno@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('15', 'Raúl', 'Jiménez', 'raul.jimenez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('16', 'Pablo', 'Ramírez', 'pablo.ramirez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('17', 'Natalia', 'Luna', 'natalia.luna@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('18', 'Diego', 'Ortega', 'diego.ortega@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('19', 'Valeria', 'Soto', 'valeria.soto@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('20', 'Andrés', 'Herrera', 'andres.herrera@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('21', 'Carolina', 'Rojas', 'carolina.rojas@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('22', 'Martín', 'Gutiérrez', 'martin.gutierrez@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('23', 'Camila', 'Silva', 'camila.silva@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('24', 'Gonzalo', 'Mendoza', 'gonzalo.mendoza@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg'),
  ('25', 'Julieta', 'Paz', 'julieta.paz@gmail.com', 'https://i.pinimg.com/originals/55/0f/49/550f49a459548599a5a4ea1c67fc0244.jpg');

INSERT INTO editorial (nombre_editorial) 
VALUES ('Akal'),
	('Ediciones B'),
	('Planeta'),
	('Alfaguara'),
	('Penguin Random House'),
	('HarperCollins'),
	('Sexto Piso'),
	('Tusquets'),
	('Random House'),
  ('Anagrama'),
  ('Santillana'),
  ('Siruela'),
  ('Grijalbo'),
  ('Fondo de Cultura Económica'),
  ('Ediciones SM'),
  ('Ediciones Sirio'),
  ('Galaxia Gutenberg'),
  ('Roca Editorial'),
  ('Ediciones Urano'),
  ('Ediciones Minotauro'),
  ('Plaza & Janés'),
  ('Ediciones Alianza');

INSERT INTO encuadernado (tipo)
VALUES
  ('Rústica'),
  ('Espiral'),
  ('Tapa dura'),
  ('Tapa blanda'),
  ('Encuadernación artesanal'),
  ('Piel'),
  ('Tapa blanda con solapas'),
  ('Encuadernación japonesa');

INSERT INTO libro (titulo, descripcion)
VALUES
  ('Los primeros hombres en la Luna', 'Descripción del Libro Los primeros hombres en la Luna'),
  ('Viaje al centro de la Tierra', 'Descripción del Libro Viaje al centro de la Tierra'),
  ('Una odisea del espacio', 'Descripción del Libro Una odisea del espacio'),
  ('El hombre bicentenario', 'Descripción del Libro El hombre bicentenario'),
  ('Dune', 'Descripción del Libro Dune'),
  ('El señor de las moscas', 'Descripción del Libro El señor de las moscas'),
  ('Fahrenheit 451', 'Descripción del Libro Fahrenheit 451'),
  ('El juego de Ender', 'Descripción del Libro El juego de Ender'),
  ('La guerra de los mundos', 'Descripción del Libro La guerra de los mundos'),
  ('Cuentos macabros', 'Descripción del Libro Cuentos macabros'),
  ('El gato negro', 'Descripción del Libro El gato negro'),
  ('El corazón delator', 'Descripción del Libro El corazón delator'),
  ('El retrato de Dorian Gray', 'Descripción del Libro El retrato de Dorian Gray'),
  ('El extraño caso del Dr. Jekyll y Mr. Hyde', 'Descripción del Libro El extraño caso del Dr. Jekyll y Mr. Hyde'),
  ('La isla del doctor Moreau', 'Descripción del Libro La isla del doctor Moreau'),
  ('1984', 'Descripción del Libro 1984'),
  ('Crónicas marcianas', 'Descripción del Libro Crónicas marcianas'),
  ('El señor de los anillos: La comunidad del anillo', 'Descripción del Libro El señor de los anillos: La comunidad del anillo'),
  ('El código Da Vinci', 'Descripción del Libro El código Da Vinci'),
  ('Matar a un ruiseñor', 'Descripción del Libro Matar a un ruiseñor'),
  ('Orgullo y prejuicio', 'Descripción del Libro Orgullo y prejuicio'),
  ('Cien años de soledad', 'Descripción del Libro Cien años de soledad'),
  ('Harry Potter y la piedra filosofal', 'Descripción del Libro Harry Potter y la piedra filosofal'),
  ('Don Quijote de la Mancha', 'Descripción del Libro Don Quijote de la Mancha'),
  ('El principito', 'Descripción del Libro El principito'),
  ('La sombra del viento', 'Descripción del Libro La sombra del viento'),
  ('El Laberinto de los Espíritus', 'Descripción del Libro El Laberinto de los Espíritus'),
  ('Rayuela', 'Descripción del Libro Rayuela'),
  ('Pedro Páramo', 'Descripción del Libro Pedro Páramo'),
  ('El Aleph', 'Descripción del Libro El Aleph'),
  ('Ensayo sobre la ceguera', 'Descripción del Libro Ensayo sobre la ceguera'),
  ('Crónica de una muerte anunciada', 'Descripción del Libro Crónica de una muerte anunciada'),
  ('El túnel', 'Descripción del Libro El túnel'),
  ('Crimen y castigo', 'Descripción del Libro Crimen y castigo'),
  ('Anna Karenina', 'Descripción del Libro Anna Karenina'),
  ('Mujer en punto cero', 'Descripción del Libro Mujer en punto cero'),
  ('El Gran Gatsby', 'Descripción del Libro El Gran Gatsby'),
  ('El lobo estepario', 'Descripción del Libro El lobo estepario'),
  ('El perfume', 'Descripción del Libro El perfume'),
  ('Las uvas de la ira', 'Descripción del Libro Las uvas de la ira'),
  ('Matar a un ruiseñor', 'Descripción del Libro Matar a un ruiseñor'),
  ('Ulises', 'Descripción del Libro Ulises'),
  ('La insoportable levedad del ser', 'Descripción del Libro La insoportable levedad del ser'),
  ('El guardián entre el centeno', 'Descripción del Libro El guardián entre el centeno');


INSERT INTO ejemplar (isbn, precio, stock, dimensiones, paginas, id_libro, id_editorial, id_encuadernado)
VALUES
  (1000000001, 2450.99, 50, '21x15 cm', 180, 1, 1, 1),
  (1000000002, 1990.99, 30, '20x14 cm', 150, 2, 1, 2),
  (1000000003, 2930.99, 40, '22x16 cm', 200, 3, 1, 3),
  (1000000004, 1438.99, 20, '18x12 cm', 120, 4, 2, 4),
  (1000000005, 34.99, 60, '25x18 cm', 250, 5, 3, 5),
  (1000000006, 2710.99, 45, '23x17 cm', 220, 6, 5, 6),
  (1000000007, 2298.99, 35, '19x13 cm', 170, 7, 8, 7),
  (1000000008, 3148.99, 55, '24x20 cm', 210, 8, 6, 8),
  (1000000009, 1648.99, 25, '17x11 cm', 130, 9, 2, 1),
  (1000000010, 2929.99, 48, '21x16 cm', 190, 10, 9, 2),
  (1000000011, 1852.99, 33, '20x15 cm', 160, 11, 1, 3),
  (1000000012, 2698.99, 42, '22x17 cm', 200, 12, 4, 4),
  (1000000013, 2300.99, 37, '18x14 cm', 140, 13, 2, 5),
  (1000000014, 3202.99, 53, '23x18 cm', 230, 14, 1, 6),
  (1000000015, 2049.99, 28, '19x12 cm', 150, 15, 7, 7),
  (1000000016, 2499.99, 32, '20x15 cm', 180, 16, 10, 8),
  (1000000017, 1890.99, 25, '19x14 cm', 160, 17, 11, 1),
  (1000000018, 3450.99, 42, '22x16 cm', 220, 18, 12, 2),
  (1000000019, 2699.99, 10, '21x17 cm', 200, 19, 13, 3),
  (1000000020, 2299.99, 30, '18x13 cm', 180, 20, 14, 4),
  (1000000021, 1999.99, 35, '20x15 cm', 150, 21, 15, 5),
  (1000000022, 3150.99, 48, '23x18 cm', 250, 22, 16, 6),
  (1000000023, 2799.99, 50, '24x19 cm', 220, 23, 17, 7),
  (1000000024, 3599.99, 55, '22x17 cm', 300, 24, 18, 8),
  (1000000025, 1899.99, 40, '16x12 cm', 100, 25, 19, 1),
  (1000000026, 2599.99, 38, '21x15 cm', 190, 6, 2, 3),
  (1000000027, 1750.99, 22, '20x14 cm', 140, 7, 3, 4),
  (1000000028, 2999.99, 0, '22x16 cm', 210, 8, 4, 5),
  (1000000029, 1348.99, 15, '18x12 cm', 110, 9, 5, 6),
  (1000000030, 29.99, 58, '25x18 cm', 260, 10, 6, 7),
  (1000000031, 2510.99, 40, '23x17 cm', 230, 11, 7, 8),
  (1000000032, 2098.99, 28, '19x13 cm', 160, 12, 8, 1),
  (1000000033, 2948.99, 50, '24x20 cm', 220, 13, 9, 2),
  (1000000034, 1548.99, 20, '17x11 cm', 130, 14, 10, 3),
  (1000000035, 2729.99, 43, '21x16 cm', 180, 15, 11, 4),
  (1000000036, 1952.99, 32, '20x15 cm', 170, 16, 12, 5),
  (1000000037, 2898.99, 0, '22x17 cm', 210, 17, 13, 6),
  (1000000038, 2500.99, 30, '18x14 cm', 140, 18, 14, 7),
  (1000000039, 3402.99, 53, '23x18 cm', 240, 19, 15, 8),
  (1000000040, 2249.99, 28, '19x12 cm', 160, 20, 16, 1),
  (1000000041, 2699.99, 32, '20x15 cm', 180, 21, 17, 2),
  (1000000042, 1990.99, 25, '19x14 cm', 150, 22, 18, 3),
  (1000000043, 3250.99, 42, '22x16 cm', 230, 23, 19, 4),
  (1000000044, 2499.99, 48, '21x17 cm', 200, 24, 20, 5),
  (1000000045, 3699.99, 55, '24x19 cm', 300, 25, 1, 6),
  (1000000046, 1999.99, 40, '16x12 cm', 120, 1, 2, 7),
  (1000000047, 2150.99, 22, '15x10 cm', 90, 2, 3, 8),
  (1000000048, 3277.99, 0, '22x17 cm', 190, 3, 4, 1),
  (1000000049, 1748.99, 15, '18x12 cm', 110, 4, 5, 2),
  (1000000050, 38.99, 58, '25x18 cm', 260, 5, 6, 3),
  (1000000051, 2450.99, 50, '21x15 cm', 180, 26, 1, 1),
  (1000000052, 1990.99, 30, '20x14 cm', 150, 27, 1, 2),
  (1000000053, 2930.99, 40, '22x16 cm', 200, 28, 1, 3),
  (1000000054, 1438.99, 20, '18x12 cm', 120, 29, 2, 4),
  (1000000055, 34.99, 60, '25x18 cm', 250, 30, 3, 5),
  (1000000056, 2710.99, 45, '23x17 cm', 220, 31, 5, 6),
  (1000000057, 2298.99, 35, '19x13 cm', 170, 32, 8, 7),
  (1000000058, 3148.99, 55, '24x20 cm', 210, 33, 6, 8),
  (1000000059, 1648.99, 25, '17x11 cm', 130, 34, 2, 1),
  (1000000060, 2929.99, 48, '21x16 cm', 190, 35, 9, 2),
  (1000000061, 1852.99, 33, '20x15 cm', 160, 36, 1, 3),
  (1000000062, 2698.99, 42, '22x17 cm', 200, 37, 4, 4),
  (1000000063, 2300.99, 37, '18x14 cm', 140, 38, 2, 5),
  (1000000064, 3202.99, 53, '23x18 cm', 230, 39, 1, 6),
  (1000000065, 2049.99, 28, '19x12 cm', 150, 40, 7, 7),
  (1000000066, 2499.99, 32, '20x15 cm', 180, 41, 10, 8),
  (1000000067, 1890.99, 25, '19x14 cm', 160, 42, 11, 1),
  (1000000068, 3450.99, 42, '22x16 cm', 220, 43, 12, 2),
  (1000000069, 2699.99, 0, '21x17 cm', 200, 44, 13, 3),
  (1000000070, 2299.99, 30, '18x13 cm', 180, 44, 14, 4);

INSERT INTO favorito_libro (id_usuario, id_libro)
VALUES
  ('1', 1),
  ('2', 2),
  ('3', 3),
  ('4', 4),
  ('5', 5),
  ('6', 6),
  ('7', 7),
  ('8', 8),
  ('9', 9),
  ('10', 10),
  ('11', 11),
  ('12', 12),
  ('13', 13),
  ('14', 14),
  ('15', 15),
  ('16', 16),
  ('17', 17),
  ('18', 18),
  ('19', 19),
  ('20', 20),
  ('21', 21),
  ('22', 22),
  ('23', 23),
  ('24', 24),
  ('25', 25),
  ('1', 17),
  ('2', 18),
  ('3', 19),
  ('4', 20),
  ('5', 21),
  ('6', 22),
  ('7', 23),
  ('8', 24),
  ('9', 25),
  ('10', 1),
  ('11', 2),
  ('12', 3),
  ('13', 4),
  ('14', 5),
  ('15', 6),
  ('16', 7),
  ('17', 8),
  ('18', 9),
  ('19', 10),
  ('20', 11),
  ('21', 12),
  ('22', 13),
  ('23', 14),
  ('24', 15),
  ('25', 16),
  ('1', 23),
  ('2', 24),
  ('3', 25),
  ('4', 1),
  ('5', 2),
  ('6', 3),
  ('7', 4),
  ('8', 5),
  ('9', 16),
  ('10', 7),
  ('11', 8),
  ('12', 9),
  ('13', 10),
  ('14', 11),
  ('15', 12),
  ('1', 21),
  ('2', 10),
  ('3', 17),
  ('4', 8),
  ('5', 13),
  ('6', 25),
  ('7', 6),
  ('8', 15),
  ('9', 19),
  ('10', 2),
  ('11', 12),
  ('12', 23),
  ('13', 5),
  ('14', 15),
  ('15', 20),
  ('16', 9),
  ('17', 1),
  ('18', 19),
  ('19', 24),
  ('20', 12),
  ('21', 4),
  ('22', 7),
  ('23', 22),
  ('24', 3),
  ('25', 17);

INSERT INTO deseo_libro (id_usuario, id_libro)
VALUES
  ('2', 10),
  ('2', 12),
  ('3', 15),
  ('4', 4),
  ('5', 7),
  ('6', 11),
  ('7', 2),
  ('8', 5),
  ('9', 13),
  ('10', 14),
  ('2', 1),
  ('2', 15),
  ('3', 8),
  ('4', 10),
  ('2', 3),
  ('11', 16),
  ('12', 9),
  ('13', 19),
  ('14', 17),
  ('15', 20),
  ('16', 22),
  ('17', 6),
  ('18', 23),
  ('19', 18),
  ('20', 25),
  ('21', 1),
  ('22', 21),
  ('23', 14),
  ('24', 11),
  ('25', 24),
  ('4', 18),
  ('2', 22),
  ('3', 3),
  ('4', 13),
  ('5', 25),
  ('6', 15),
  ('7', 20),
  ('8', 9),
  ('9', 17),
  ('10', 24),
  ('11', 2),
  ('12', 8),
  ('13', 23),
  ('14', 12),
  ('15', 5),
  ('16', 21),
  ('17', 16),
  ('18', 7),
  ('19', 10),
  ('20', 4),
  ('21', 19),
  ('22', 6),
  ('24', 20),
  ('25', 3),
  ('1', 18),
  ('2', 20),
  ('3', 14),
  ('4', 11),
  ('5', 16),
  ('6', 21),
  ('7', 8),
  ('8', 15),
  ('9', 19),
  ('10', 22),
  ('11', 5),
  ('12', 17),
  ('13', 24),
  ('14', 9),
  ('15', 12),
  ('16', 7),
  ('17', 2),
  ('18', 13),
  ('19', 25),
  ('20', 3),
  ('21', 10),
  ('22', 23),
  ('23', 6),
  ('24', 1),
  ('25', 4);


INSERT INTO autor (nombre_autor) 
VALUES
  ('H. G. Wells'),
  ('Julio Verne'),
  ('Arthur C. Clarke'),
  ('Isaac Asimov'),
  ('Frank Herbert'),
  ('William Golding'),
  ('Ray Bradbury'),
  ('Orson Scott Card'),
  ('Edgar Allan Poe'),
  ('J. R. R. Tolkien'),
  ('Stephen King'),
  ('George R. R. Martin'),
  ('J. K. Rowling'),
  ('Neil Gaiman'),
  ('Agatha Christie'),
  ('Gabriel García Márquez'),
  ('Haruki Murakami'),
  ('Jane Austen'),
  ('Philip K. Dick');


INSERT INTO libro_autor (id_libro, id_autor) 
VALUES
(1, 7),
	(2, 1),
	(3, 1),
	(4, 2),
	(5, 3),
	(6, 4),
	(7, 5),
	(8, 6),
	(9, 7),
	(10, 8),
	(11, 8),
	(12, 8),
	(13, 9),
	(14, 8),
	(15, 10),
	(16, 11),
	(17, 12),
	(18, 13),
	(19, 14),
	(20, 15),
	(21, 16),
	(22, 17),
	(23, 18),
	(24, 19),
	(25, 19),
  (26, 2),
  (27, 8),
  (28, 2),
  (29, 8),
  (30, 8),
  (31, 6),
  (32, 7),
  (33, 9),
  (34, 3),
  (35, 11),
  (36, 12),
  (37, 8),
  (38, 6),
  (39, 4),
  (40, 7),
  (41, 11),
  (26, 3),
  (27, 1),
  (28, 10),
  (29, 3),
  (30, 4),
  (31, 5),
  (32, 1),
  (33, 5),
  (34, 5),
  (35, 4),
  (36, 5),
  (37, 6),
  (38, 7),
  (39, 8),
  (40, 9),
  (41, 10),
(42, 3),
(43, 7),
(44, 5);

INSERT INTO genero (nombre_genero)
VALUES
  ('Ciencia ficción'),
  ('Fantasía'),
  ('Terror'),
  ('Romance'),
  ('Suspense'),
  ('Drama'),
  ('Comedia'),
  ('No ficción'),
  ('Literatura infantil'),
  ('Misterio'),
  ('Aventura'),
  ('Histórico'),
  ('Ciencia'),
  ('Poesía'),
  ('Biografía'),
  ('Ensayo');

INSERT INTO libro_genero (id_libro, id_genero)
VALUES
  (1, 1),
  (2, 1),
  (3, 1),
  (4, 2),
  (5, 1),
  (6, 6),
  (7, 5),
  (8, 1),
  (9, 1),
  (10, 3),
  (11, 3),
  (12, 3),
  (13, 2),
  (14, 3),
  (15, 1),
  (16, 2),
  (17, 1),
  (18, 2),
  (19, 1),
  (20, 3),
  (21, 6),
  (22, 1),
  (23, 4),
  (24, 7),
  (25, 8),
  (26, 1),
  (27, 1),
  (28, 1),
  (29, 2),
  (30, 2),
  (31, 2),
  (32, 3),
  (33, 3),
  (34, 3),
  (35, 4),
  (36, 4),
  (37, 4),
  (38, 5),
  (39, 5),
  (40, 5),
  (41, 6),
  (42, 6),
  (43, 7),
  (44, 7),
  (6, 8),
  (7, 8),
  (8, 8),
  (26, 12),
  (27, 2),
  (28, 3),
  (29, 4),
  (30, 5),
  (31, 6),
  (32, 7),
  (33, 8),
  (34, 9),
  (35, 10),
  (36, 11),
  (37, 12),
  (38, 13),
  (39, 14),
  (40, 15),
  (41, 16);

INSERT INTO promocion_descuento (nombre_promocion, porcentaje, fecha_inicio, fecha_fin, imagen)
VALUES
  ('25% de descuento en todos los libros', 25.00, CURRENT_TIMESTAMP, '2027-05-31 00:00:00', NULL),
  ('30% de descuento en libros de ciencia ficción', 30.00, '2025-04-19 00:00:00', '2027-06-21 00:00:00', NULL),
  ('15% de descuento en libros de más de 500 páginas', 15.00, '2025-05-24 00:00:00', '2027-05-31 00:00:00', NULL),
  ('20% de descuento en libros de autores españoles', 20.00, '2025-04-20 00:00:00', '2027-04-21 00:00:00', NULL),
  ('10% de descuento en todos los libros digitales', 10.00, '2025-04-20 00:00:00', '2027-05-25 00:00:00', NULL),
  ('Descuento de Año Nuevo', 15.00, '2025-06-01 00:00:00', '2027-07-10 00:00:00', NULL),
  ('Oferta de Verano', 20.00, '2025-04-20 00:00:00', '2027-04-19 00:00:00', NULL),
  ('Descuento de Primavera', 18.00, '2025-04-05 00:00:00', '2027-04-20 00:00:00', NULL),
  ('Promoción de Halloween', 25.00, '2025-10-15 00:00:00', '2027-11-01 00:00:00', NULL),
  ('Descuento del Día del Libro', 12.00, '2025-04-23 00:00:00', '2027-05-30 00:00:00', NULL),
  ('Oferta de Fin de Año', 30.00, '2025-12-15 00:00:00', '2027-12-31 00:00:00', NULL),
  ('Descuento de San Valentín', 14.00, '2025-04-20 00:00:00', '2027-08-14 00:00:00', NULL),
  ('Oferta de Semana Santa', 18.00, '2025-04-10 00:00:00', '2027-04-17 00:00:00', NULL),
  ('Descuento del Día del Trabajo', 15.00, '2025-05-01 00:00:00', '2027-05-10 00:00:00', NULL),
  ('Promoción del Día del Padre', 20.00, '2025-06-01 00:00:00', '2027-06-15 00:00:00', NULL);

INSERT INTO ejemplar_promocion (id_ejemplar, id_promocion_descuento)
VALUES
  (1000000001, 1),
  (1000000002, 1),
  (1000000003, 1),
  (1000000004, 2),
  (1000000005, 1),
  (1000000006, 3),
  (1000000007, 4),
  (1000000008, 2),
  (1000000009, 1),
  (1000000010, 3),
  (1000000011, 3),
  (1000000012, 3),
  (1000000013, 2),
  (1000000014, 3),
  (1000000015, 4),
  (1000000016, 5),
  (1000000017, 5),
  (1000000018, 5),
  (1000000019, 6),
  (1000000020, 6),
  (1000000021, 6),
  (1000000022, 7),
  (1000000023, 7),
  (1000000024, 7),
  (1000000025, 8),
  (1000000009, 8),
  (1000000012, 8),
  (1000000015, 8);

INSERT INTO ciudad (cp, nombre_ciudad)
VALUES
(3265, 'Villa Elisa'),
(3260, 'Concepción del Uruguay'),
(2820, 'Gualeguaychú'),
(3100, 'Paraná'),
(2000, 'Rosario'),
(3190, 'La Paz'),
(3240, 'Villaguay'),
(3200, 'Concordia'),
(5000, 'Córdoba Capital'),
(2854, 'Larroque'),
(3206, 'Federación'),
(3280, 'Colon'),
(3228, 'Chajarí'),
(2840, 'Gualeguay'),
(3170, 'Basavilbaso');

INSERT INTO direccion (calle, numero, id_usuario, cp_ciudad)
VALUES
 ('Urquiza', 2420, '1', 3265),
 ('Dr. Gutierrez', 1460, '2', 2000),
 ('Rocamora', 1119, '3', 3260),
 ('Almafuerte', 1033, '4', 3100),
 ('Estrada', 820, '5', 3260),
 ('17 de Octubre', 96, '6', 3100),
 ('Belgrano', 1187, '7', 3260),
 ('Rivadavia', 1240, '8', 2820),
 ('España', 255, '9', 3260),
 ('Viamonte', 3600, '10', 2000),
 ('9 de Julio', 262, '11', 3240),
 ('Maipú', 714, '12', 3260),
 ('Villaguay', 570, '13', 3100),
 ('3 de Febrero', 31, '14', 3280),
 ('Manzur', 12, '15', 3170),
 ('San Martín', 180, '16', 3100),
 ('Alem', 482, '17', 3260),
 ('San Lorenzo', 560, '18', 3240),
 ('Castelli', 890, '19', 3265),
 ('Uruguay', 1975, '20', 3100),
 ('Laprida', 745, '21', 3260),
 ('Bolívar', 320, '22', 3280),
 ('Salta', 900, '23', 3260),
 ('Pellegrini', 1111, '24', 3100),
 ('Tucumán', 430, '25', 3260),
 ('San Martín', 567, '1', 3100),
 ('Mitre', 789, '2', 2820),
 ('San Juan', 432, '3', 3260),
 ('Belgrano', 987, '4', 3170),
 ('Sarmiento', 654, '5', 3240),
 ('Buenos Aires', 321, '6', 3100),
 ('Entre Ríos', 765, '7', 3260),
 ('Colon', 876, '8', 3280),
 ('Lavalle', 543, '9', 3265),
 ('Avenida Argentina', 210, '10', 2820),
 ('Santa Fe', 987, '1', 3100),
 ('Jujuy', 654, '12', 3240),
 ('Montevideo', 321, '1', 3100),
 ('Catamarca', 876, '4', 3280),
 ('Corrientes', 543, '5', 3265),
 ('Pueyrredón', 210, '6', 2820),
 ('Libertad', 987, '7', 3100),
 ('9 de Julio', 654, '7', 3240),
 ('San Luis', 321, '9', 3100),
 ('Mendoza', 876, '2', 3280),
 ('Tucumán', 543, '2', 3265),
 ('Chaco', 210, '2', 2820),
 ('Rivadavia', 987, '3', 3100),
 ('Castellanos', 654, '4', 3240),
 ('Avellaneda', 321, '5', 3100);

INSERT INTO tipo_envio(descripcion) VALUES ('Retiro'), ('Domicilio');

INSERT INTO linea_carrito(id_carrito, id_ejemplar, cantidad) VALUES
	(3, 1000000007, 1),
	(3, 1000000013, 2),
	(3, 1000000015, 1),
	(8, 1000000002, 2),
	(8, 1000000012, 1),
	(8, 1000000020, 3),
	(2, 1000000010, 1),
	(2, 1000000022, 2),
	(2, 1000000015, 1),
	(6, 1000000001, 3),
	(6, 1000000021, 1),
	(13, 1000000002, 1),
	(13, 1000000011, 1),
	(13, 1000000024, 1),
	(3, 1000000009, 2),
	(7, 1000000008, 4),
	(7, 1000000012, 2),
	(7, 1000000025, 1),
	(2, 1000000011, 3),
	(2, 1000000023, 2),
	(9, 1000000003, 1),
	(9, 1000000020, 2),
	(15, 1000000008, 2),
	(15, 1000000023, 1),
	(11, 1000000001, 1),
	(11, 1000000014, 2),
	(10, 1000000014, 1),
	(10, 1000000022, 1),
	(10, 1000000024, 1),
	(4, 1000000006, 12),
	(4, 1000000010, 3),
	(4, 1000000015, 2),
	(12, 1000000007, 1),
	(12, 1000000015, 1),
	(8, 1000000001, 2),
	(8, 1000000009, 1),
	(8, 1000000015, 1),
	(2, 1000000005, 2),
	(6, 1000000020, 1),
	(13, 1000000012, 3),
	(7, 1000000024, 2),
	(9, 1000000013, 1),
	(15, 1000000022, 3),
	(11, 1000000004, 2),
	(11, 1000000016, 1),
	(4, 1000000017, 2),
	(12, 1000000025, 1),
	(8, 1000000023, 1),
	(5, 1000000017, 2),
	(10, 1000000025, 1),
	(14, 1000000023, 1),
	(16, 1000000021, 2),
	(19, 1000000024, 1),
	(17, 1000000023, 2),
	(18, 1000000014, 1),
	(20, 1000000005, 2),
	(21, 1000000007, 1),
	(22, 1000000013, 2),
	(22, 1000000005, 2),
	(23, 1000000011, 2),
	(23, 1000000015, 1),
	(24, 1000000022, 3),
	(24, 1000000023, 1),
	(25, 1000000010, 2),
	(25, 1000000004, 2),
	(6, 1000000014, 1),
	(7, 1000000022, 1),
	(8, 1000000024, 1),
	(9, 1000000023, 2),
	(3, 1000000014, 1);

INSERT INTO pedido(id_envio, costo_envio, id_usuario, id_direccion) VALUES
	(2,  1500, '3', 3),
	(2, 2400, '8', 8),
	(2, 9100, '2', 2),
	(1, 0, '6', 6),
	(2, 1200, '13', 13),
	(2, 3000, '7', 7),
	(1, 0, '9', 9),
	(2, 2000, '15', 15),
	(2, 3200, '11', 11),
	(2, 1200, '10', 10),
	(1, 0, '4', 4),
	(2, 1500, '12', 12),
	(1, 0, '5', 5),
	(2, 2500, '14', 14),
	(1, 0, '16', 16),
	(2,3000, '19', 19),
	(2, 1200, '17', 17),
	(2, 1500, '18', 18),
	(1, 0, '20', 20),
	(2, 2000, '21', 21),
	(2, 2800, '22', 22),
	(2, 1900, '23', 23),
	(1, 0, '24', 24),
	(2, 1500, '25', 25);

INSERT INTO resenia(texto, valoracion, id_usuario, id_libro) VALUES
	('Una historia fascinante que me mantuvo atrapado de principio a fin', 5, '3',7),
	('El desarrollo de los personajes es increíble, pero el final me dejó un poco decepcionado', 4, '8',2),
	('Un libro que te hace reflexionar sobre la vida y la muerte. Altamente recomendado.', 5, '2', 10),
	('La trama es interesante, pero algunos capítulos se sienten un poco lentos.', 3, '6', 1),
	('Personajes bien construidos y diálogos convincentes. Me encantó.', 5, '13',2),
	('No pude conectar con la historia, aunque la escritura era buena.', 2,'3',15),
	('Un thriller emocionante que te mantiene en vilo hasta la última página.', 4, '7', 8),
	('La ambientación del libro es fantástica, te transporta a otro mundo.', 5, '2', 22),
	('Demasiados giros inesperados que dificultaron seguir la trama.', 3, '9', 3),
	('Una obra maestra de la literatura contemporánea. Imprescindible.', 5, '15', 22),
	('La narrativa es envolvente, pero algunos personajes carecen de profundidad.', 4, '11', 1),
	('Me encantó la originalidad de la trama. Nunca he leído algo así antes.', 5, '11', 14),
	('El inicio fue prometedor, pero el desenlace fue predecible.', 3, '4', 6),
	('No puedo creer que haya perdido tiempo leyendo esto. Totalmente aburrido.', 1, '12', 7),
	('Una lectura ligera y entretenida para pasar el tiempo.', 4, '8', 1),
	('Me encantó la trama y la forma en que se desarrollaron los personajes. Altamente recomendado.', 5, '3', 13),
	('Interesante historia, aunque algunos capítulos me parecieron un poco confusos.', 3, '10', 22),
	('Me sorprendió gratamente la trama y los personajes. Sin duda, lo leería de nuevo.', 4, '13', 11),
	('Un thriller psicológico que te mantiene en vilo hasta la última página. Imprescindible.', 5, '7', 12),
	('La mezcla de misterio y fantasía en este libro es fascinante. No pude soltarlo.', 5, '2', 11),
	('Algunos giros inesperados mantuvieron mi interés, pero el final fue un poco abrupto.', 4, '9', 13),
	('Una obra maestra que me dejó reflexionando sobre la vida. Definitivamente, un libro para recordar.', 5, '15', 23),
	('La narrativa es envolvente y los personajes están bien desarrollados. Me encantó.', 5, '13', 24),
	('El misterio y la intriga en esta historia me mantuvieron enganchado. Altamente recomendado.', 4, '10', 14),
	('La trama tenía potencial, pero algunos elementos me parecieron predecibles.', 3, '4', 10),
	('Este libro no cumplió con mis expectativas. La historia fue decepcionante.', 2, '12', 15),
	('Una lectura fascinante que te hace reflexionar sobre la vida. No puedo esperar para leer más del autor.', 5, '8', 15);

INSERT INTO linea_carrito(id_carrito, id_ejemplar, cantidad) VALUES
	(1, 1000000003, 1),
	(2, 1000000005, 2),
	(1, 1000000008, 1),
	(4, 1000000001, 3),
	(4, 1000000010, 1),
	(6, 1000000015, 1),
	(5, 1000000011, 2),
	(5, 1000000018, 1),
	(5, 1000000020, 3),
	(9, 1000000004, 1),
	(9, 1000000015, 2),
	(9, 1000000022, 1),
	(14, 1000000010, 3),
	(14, 1000000021, 2),
	(14, 1000000015, 1),
	(18, 1000000002, 2),
	(18, 1000000019, 1),
	(18, 1000000023, 1),
	(20, 1000000006, 1),
	(20, 1000000013, 2),
	(20, 1000000020, 2),
	(21, 1000000008, 1),
	(21, 1000000016, 2),
	(21, 1000000024, 1);

INSERT INTO pregunta_frecuente (pregunta, respuesta)
VALUES
    ('¿Cuál es el tiempo de entrega de los libros?', 'El tiempo de entrega de los libros físicos varía según la ubicación y el método de envío seleccionado. Por lo general, el tiempo estimado de entrega es de 3 a 7 días hábiles.'),
    ('¿Puedo devolver un libro si no estoy satisfecho?', 'Sí, puedes devolver un libro si no estás satisfecho. Para ello, debes contactar con nuestro servicio de atención al cliente dentro de los 30 días posteriores a la recepción del libro y seguir las instrucciones para la devolución.'),
    ('¿Cuál es el costo de envío?', 'El costo de envío depende del destino y del peso del libro. Durante el proceso de compra, se te mostrará el costo de envío correspondiente a tu dirección de entrega.'),
    ('¿Qué métodos de pago aceptan?', 'Aceptamos como método de pago únicamente Mercado Pago.'),
    ('¿Qué debo hacer si mi libro llega dañado?', 'Si tu libro llega dañado, por favor contáctanos de inmediato para que podamos resolver el problema. Podremos ofrecerte un reemplazo o un reembolso, dependiendo de tu preferencia.'),
    ('¿Puedo cancelar mi pedido?', 'Sí, puedes cancelar tu pedido siempre y cuando no haya sido enviado. Por favor, contáctanos lo antes posible si deseas cancelar tu pedido.'),
    ('¿Puedo realizar un cambio de dirección de entrega después de realizar el pedido?', 'Si deseas realizar un cambio de dirección de entrega después de realizar el pedido, por favor contáctanos lo antes posible. Haremos nuestro mejor esfuerzo para actualizar la dirección de entrega, siempre y cuando el pedido no haya sido enviado.'),
    ('¿Puedo comprar un producto sin crear una cuenta?', 'No, no puedes comprar un producto sin crear una cuenta. Además, crear una cuenta te permitirá acceder a tu lista de libros favoritos y administrar tu lista de deseos, entre otras cosas.'),
    ('¿Qué debo hacer si no recibo mi pedido en el plazo de entrega estimado?', 'Si no recibes tu pedido en el plazo de entrega estimado, por favor contáctanos para que podamos investigar el problema.'),
    ('¿Qué países tienen cobertura de envío?', 'En este momento, solo realizamos envíos a Argentina.'),
    ('¿Qué debo hacer si tengo un problema con mi cuenta?', 'Si tienes un problema con tu cuenta, por favor contáctanos para que podamos ayudarte.'),
    ('¿Cómo puedo agregar un producto a mi lista de deseos?', 'Puedes agregar un producto a tu lista de deseos haciendo clic en el icono de corazón que se encuentra junto al producto.');


-- Elimina el trigger que calcula el total con descuento cuando se carga un pedido porque no andaba bien. Directamente cargamos total_con_descuento desde el front
DROP TRIGGER calcular_total_trigger ON pedido;

COMMIT;




